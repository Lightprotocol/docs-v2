~~~~text
---
argument-hint: <project_path>
description: Create associated light-token account client implementation in Rust
allowed-tools: [Bash, Read, Glob, Grep, Task, mcp__deepwiki, mcp__zkcompression]
---

## Task: Create associated light-token account client (Rust)

References:
- Client Guide: https://zkcompression.com/light-token/cookbook/create-ata
- SDK Reference: https://docs.rs/light-token/latest/light_token/
- GitHub Example: https://github.com/Lightprotocol/examples-light-token

MCP:
* deepwiki https://mcp.deepwiki.com/mcp
* zkcompression https://www.zkcompression.com/mcp

## Workflow

- This plan must execute without user intervention
- All questions have been resolved in planning phase
- If blocked, find alternative approach - do not stop
- Keep working until ALL todos are complete
- Use Task tool with subagents for parallel research or when stuck
- Use subagents with Read, Glob, Grep, and Deepwiki permissions when stuck
- Always assign Tasks to subagents and tell the user

## DeepWiki fallback

```
mcp__deepwiki__read_wiki_structure("Lightprotocol/light-protocol"),
mcp__deepwiki__read_wiki_contents("Lightprotocol/light-protocol"),
mcp__deepwiki__ask_question("Lightprotocol/light-protocol", "<question>")
```

## Quick Reference

| Operation | Function | Purpose |
|-----------|----------|---------|
| Connect | LightClient::new() | Connect to ZK Compression RPC endpoint |
| Derive ATA Address | derive_token_ata() | Derive deterministic ATA address from owner and mint |
| Build Instruction | CreateAssociatedTokenAccount::new() | Build instruction with default rent config |
| Send Transaction | create_and_send_transaction() | Submit transaction to network |
| Verify Account | get_account() | Fetch and verify ATA creation |

### Phase 1: Index project

```bash
grep -r "light_client\|LightClient\|light_token_sdk" src/
```

### Phase 2: Add dependencies

```toml
[dependencies]
light-client = "0.16.0"
light-token-sdk = "0.16.0"
light-token-interface = "0.16.0"
solana-sdk = "2.1"
tokio = { version = "1", features = ["full"] }
borsh = "1.5"
```

### Phase 3: Implement client operations

See Code Reference below for Rust implementation.

1. **RPC Setup**: Connect to ZK Compression RPC endpoint (Helius, Triton, or localnet)
   - Use `LightClient::new_with_retry()` with `LightClientConfig` for mainnet, devnet, or local URLs
   - Configure with Helius RPC URL and API key
   - Example: Lines 138-144 in create-ata.mdx Rust Client tab

2. **Create Mint** (prerequisite): Create compressed mint for testing
   - Use `create_compressed_mint()` helper function
   - Get active state trees and address tree from RPC
   - Derive compression address with `derive_cmint_compressed_address()`
   - Get validity proof for mint address
   - Build and send `CreateCMint` instruction
   - Example: Lines 176-260 in create-ata.mdx Rust Client tab

3. **Derive ATA Address**: Generate deterministic address for the associated token account
   - Use `derive_token_ata()` with owner pubkey and mint
   - Returns tuple of `(Pubkey, u8)` for ATA address and bump seed
   - Example: Lines 149-151 in create-ata.mdx Rust Client tab

4. **Build Instruction**: Create instruction with default rent config
   - Use `CreateAssociatedTokenAccount::new()` with payer, owner, and mint
   - Call `.instruction()` to get the instruction
   - Default rent config is automatically included:
     - Pre-pays ~17,208 lamports for 24h of rent + compression incentive
     - Transfers top-up 776 lamports when rent is below 3h
   - Example: Lines 154-160 in create-ata.mdx Rust Client tab

5. **Send Transaction**: Sign and submit transaction to network
   - Use `rpc.create_and_send_transaction()` with instruction array, payer pubkey, and signers
   - Only payer signs (no account keypair needed for ATA creation)
   - Returns transaction signature
   - Example: Lines 162-165 in create-ata.mdx Rust Client tab

6. **Verify Account**: Fetch and decode ATA data (optional)
   - Use `rpc.get_account()` with ATA address
   - Deserialize with `Token::deserialize()` from borsh
   - Verify mint, owner, and initial amount (should be 0)
   - Example: Lines 168-172 in create-ata.mdx Rust Client tab

### Phase 4: Test

Run the client code. On failure, debug and retry. Assign debugging to subagents with Task tool.

For localnet testing:
```bash
light test-validator
```

For devnet/mainnet, ensure RPC endpoint supports ZK Compression (Helius, Triton).

Set environment variables:
```bash
export KEYPAIR_PATH="~/.config/solana/id.json"
export api_key="your-helius-api-key"
```

~~~~
