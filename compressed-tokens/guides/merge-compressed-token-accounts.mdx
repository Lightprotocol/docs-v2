---
title: Merge Compressed Token Accounts
description: "Consolidate multiple compressed token accounts of the same mint into a single account to reduce fragmentation."
keywords: ["merge compressed token accounts", "consolidate token accounts"]
---

import FullSetup from "/snippets/setup/full-setup.mdx";
import ActionCode from '/snippets/code-snippets/compressed-token/merge-token-accounts/action.mdx';

The `mergeTokenAccounts()` function consolidates multiple compressed accounts of the same mint into a single compressed account.

The function

1. consumes multiple compressed token accounts (up to 8 accounts), and
2. creates a single output compressed token account with combined balance for the owner.

<Tip>
State trees where compressed account's are stored, are append only. `mergeTokenAccounts()` reduces account fragmentation to simplify balance calculations from `getCompressedTokenAccountsByOwner`.
</Tip>

<CodeGroup>
```typescript function-merge-accounts.ts
// Combines multiple compressed token accounts into single compressed account
const transactionSignature = await mergeTokenAccounts(
    rpc,
    payer,
    mint, // SPL mint with SPL interface for compression
    owner,
);
```
</CodeGroup>

## Get Started

<Steps>
<Step>
### Merge Compressed Accounts

<FullSetup />

<ActionCode />

<Info>
Before we merge compressed accounts, we need

* Multiple compressed token accounts of the same mint owned by the same wallet, and
* an SPL mint with an SPL interface. Create one for new mints via [`createMint()`](/compressed-tokens/guides/create-mint-with-token-pool) or for existing mints via [`createSplInterface()`](/compressed-tokens/guides/add-token-pools-to-mint-accounts).
</Info>

</Step>
</Steps>

# Troubleshooting

<AccordionGroup>
<Accordion title="No compressed token accounts found">

The owner has no compressed token accounts for the specified mint:

```typescript
// Check if accounts exist before merging
const accounts = await rpc.getCompressedTokenAccountsByOwner(
    owner.publicKey,
    { mint }
);

if (accounts.items.length === 0) {
    console.log("No compressed token accounts found for this mint");
    console.log("Mint address:", mint.toBase58());
    console.log("Owner address:", owner.publicKey.toBase58());
    return;
}

console.log(`Found ${accounts.items.length} accounts to merge`);
```

</Accordion>
</AccordionGroup>

# Advanced Configuration

<AccordionGroup>
<Accordion title="Conditional Merging">

```typescript
// Get account count
const accounts = await rpc.getCompressedTokenAccountsByOwner(
    owner.publicKey,
    { mint }
);

// Only merge if more than 2 accounts
if (accounts.items.length > 2) {
    console.log(`Merging ${accounts.items.length} accounts...`);

    const mergeTx = await mergeTokenAccounts(
        rpc,
        payer,
        mint,
        tokenOwner,
    );

    console.log("Merge completed:", mergeTx);
} else {
    console.log("Merge not needed - optimal account structure");
}
```

</Accordion>

<Accordion title="Merge Multiple Mints">

```typescript
const mints = [
    new PublicKey("MINT_1_ADDRESS"),
    new PublicKey("MINT_2_ADDRESS"),
];

// Merge accounts for each mint
for (const mint of mints) {
    console.log(`Merging accounts for mint: ${mint.toBase58()}`);

    const mergeTx = await mergeTokenAccounts(
        rpc,
        payer,
        mint,
        tokenOwner,
    );

    console.log(`Merge completed: ${mergeTx}`);
}
```

</Accordion>
</AccordionGroup>

# Next Steps

<Card
  title="How to Approve and Revoke Delegate Authority"
  icon="chevron-right"
  color="#0066ff"
  href="/compressed-tokens/guides/delegate"
  horizontal
/>
