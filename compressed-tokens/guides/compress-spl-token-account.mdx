---
title: Compress Complete SPL Token Accounts
description: "Compress the entire balance of an SPL token account to reclaim rent. Optionally leave some tokens in SPL format."
keywords: ["compress spl token accounts", "migrate spl to compressed"]
---

import FullSetup from "/snippets/setup/full-setup.mdx";
import MintPrereq from '/snippets/setup/compressed-tokens-mint-prereq.mdx';
import ActionCode from '/snippets/code-snippets/compressed-token/compress-spl-account/action.mdx';

<CodeGroup>
```typescript compressSplTokenAccount()
// Compress entire SPL token account balance
const transactionSignature = await compressSplTokenAccount(
    rpc,
    payer,
    mint, // SPL mint with SPL interface for compression
    owner,
    tokenAccount, // SPL token account to compress
);
```

```typescript partialCompression()
// Compress account while keeping some tokens in SPL format
const transactionSignature = await compressSplTokenAccount(
    rpc,
    payer,
    mint, // SPL mint with SPL interface for compression
    owner,
    tokenAccount, // SPL token account to compress
    remainingAmount, // amount to keep in SPL format
);
```
</CodeGroup>

<Note>
After compression, empty token accounts can now be closed to reclaim rent with [`closeAccount()`](https://solana.com/developers/cookbook/tokens/close-token-accounts).
</Note>

<Tip>
**Function Difference and Best Practice:**

* `compressSplTokenAccount(tokenAccount, remainingAmount)` compresses the entire SPL token account balance minus optional remaining amount only to the same owner. Use to migrate complete token accounts with optional partial retention.
* `compress(amount, sourceTokenAccount, toAddress)` compresses specific amounts from source to a specified recipient. Use for transfers and precise amounts. [Here is how](/compressed-tokens/guides/compress-decompress).
</Tip>

## Get Started

<Steps>
<Step>
### Compress SPL Token Accounts

<FullSetup />

<ActionCode />

<MintPrereq />

</Step>
</Steps>

# Troubleshooting

<AccordionGroup>
<Accordion title="Insufficient balance in token account">

The token account doesn't have enough tokens for the operation.

```typescript
// Check token account balance before compression
const balance = await rpc.getTokenAccountBalance(tokenAccount);

if (Number(balance.value.amount) === 0) {
    console.log("Token account is empty");
    return;
}

console.log("Available balance:", Number(balance.value.amount));

// Proceed with compression
const compressTx = await compressSplTokenAccount(
    rpc,
    payer,
    mint,
    owner,
    tokenAccount,
);
```

</Accordion>

<Accordion title="Remaining amount exceeds balance">

The `remainingAmount` parameter exceeds the current account balance.

```typescript
const balance = await rpc.getTokenAccountBalance(tokenAccount);
const availableAmount = Number(balance.value.amount);
const remainingAmount = bn(500_000_000); // 0.5 tokens

if (remainingAmount.gt(bn(availableAmount))) {
    console.log(`Cannot leave ${remainingAmount.toString()} tokens`);
    console.log(`Available balance: ${availableAmount}`);
    throw new Error("Remaining amount exceeds balance");
}

// Use valid remaining amount
const compressTx = await compressSplTokenAccount(
    rpc,
    payer,
    mint,
    owner,
    tokenAccount,
    remainingAmount, // must be <= balance
);
```

</Accordion>
</AccordionGroup>

# Advanced Configuration

<AccordionGroup>
<Accordion title="Partial Account Compression">

Compress most tokens while leaving some in SPL format:

```typescript
import { bn } from '@lightprotocol/stateless.js';

// Leave 100 tokens (0.1 with 9 decimals) in SPL account
const remainingAmount = bn(100_000_000);

const compressTx = await compressSplTokenAccount(
    rpc,
    payer,
    mint,
    owner,
    tokenAccount,
    remainingAmount, // amount to keep in SPL format
);

// Account will retain remainingAmount tokens
```

</Accordion>

<Accordion title="Compress Multiple Accounts">

Compress several token accounts for the same mint:

```typescript
const tokenAccounts = [
    { account: new PublicKey("ACCOUNT_1"), owner: owner1 },
    { account: new PublicKey("ACCOUNT_2"), owner: owner2 },
    { account: new PublicKey("ACCOUNT_3"), owner: owner3 },
];

// Compress each account
for (const { account, owner } of tokenAccounts) {
    console.log(`Compressing account: ${account.toBase58()}`);

    try {
        const compressTx = await compressSplTokenAccount(
            rpc,
            payer,
            mint,
            owner,
            account,
        );
        console.log(`Compressed: ${compressTx}`);
    } catch (error) {
        console.log(`Failed: ${error.message}`);
    }
}
```

</Accordion>
</AccordionGroup>

# Next Steps

<Card
  title="How to create a mint with SPL interface"
  icon="chevron-right"
  color="#0066ff"
  href="/compressed-tokens/guides/create-mint-with-token-pool"
  horizontal
/>
