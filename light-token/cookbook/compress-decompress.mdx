---
title: Compress & Decompress
sidebarTitle: Compress & Decompress
description: Convert between SPL tokens and compressed accounts (cold storage)
---

- **Compress**: Move tokens from SPL/T22 account → compressed accounts (cold storage)
- **Decompress**: Move tokens from compressed accounts (cold storage) → SPL/T22 account

<Info>
Find the source code: [compress.test.ts](https://github.com/Lightprotocol/light-protocol/blob/main/js/compressed-token/tests/e2e/compress.test.ts) | [decompress.test.ts](https://github.com/Lightprotocol/light-protocol/blob/main/js/compressed-token/tests/e2e/decompress.test.ts)
</Info>

# Get Started

<Tabs>
<Tab title="Compress">

<Steps>
<Step>
### Compress SPL Tokens to Cold Storage

<Note>
Supports batch compression to multiple recipients in a single transaction (up to 10 recipients with V2 trees).
</Note>

<CodeGroup>
```typescript Action
import { Keypair } from "@solana/web3.js";
import { createRpc, bn } from "@lightprotocol/stateless.js";
import {
  createMint,
  mintTo,
  decompress,
  compress,
} from "@lightprotocol/compressed-token";
import { createAssociatedTokenAccount } from "@solana/spl-token";

async function main() {
  const rpc = createRpc();
  const payer = Keypair.generate();
  await rpc.requestAirdrop(payer.publicKey, 10e9);

  const owner = Keypair.generate();
  await rpc.requestAirdrop(owner.publicKey, 1e9);

  const mintAuthority = Keypair.generate();
  const mintKeypair = Keypair.generate();
  const { mint } = await createMint(
    rpc,
    payer,
    mintAuthority.publicKey,
    9,
    mintKeypair
  );

  const splAta = await createAssociatedTokenAccount(
    rpc,
    payer,
    mint,
    owner.publicKey
  );

  // Mint compressed then decompress to get SPL tokens
  await mintTo(rpc, payer, mint, owner.publicKey, mintAuthority, bn(1000));
  await decompress(rpc, payer, mint, bn(1000), owner, splAta);

  // Compress SPL tokens to cold storage
  const recipient = Keypair.generate();

  const signature = await compress(
    rpc,
    payer,
    mint,
    bn(500),
    owner,
    splAta,
    recipient.publicKey
  );

  console.log("Compressed 500 tokens to cold storage");
  console.log("Transaction:", signature);
}

main().catch(console.error);
```

```typescript Batch
import { Keypair } from "@solana/web3.js";
import { createRpc, bn } from "@lightprotocol/stateless.js";
import {
  createMint,
  mintTo,
  decompress,
  compress,
} from "@lightprotocol/compressed-token";
import { createAssociatedTokenAccount } from "@solana/spl-token";

async function main() {
  const rpc = createRpc();
  const payer = Keypair.generate();
  await rpc.requestAirdrop(payer.publicKey, 10e9);

  const owner = Keypair.generate();
  await rpc.requestAirdrop(owner.publicKey, 1e9);

  const mintAuthority = Keypair.generate();
  const mintKeypair = Keypair.generate();
  const { mint } = await createMint(
    rpc,
    payer,
    mintAuthority.publicKey,
    9,
    mintKeypair
  );

  const splAta = await createAssociatedTokenAccount(
    rpc,
    payer,
    mint,
    owner.publicKey
  );

  await mintTo(rpc, payer, mint, owner.publicKey, mintAuthority, bn(10000));
  await decompress(rpc, payer, mint, bn(10000), owner, splAta);

  // Batch compress to multiple recipients (max 10 for V2 trees)
  const recipients = Array.from({ length: 5 }, () => Keypair.generate().publicKey);
  const amounts = [bn(100), bn(200), bn(300), bn(400), bn(500)];

  const signature = await compress(
    rpc,
    payer,
    mint,
    amounts,
    owner,
    splAta,
    recipients
  );

  console.log("Batch compressed to 5 recipients");
  console.log("Transaction:", signature);
}

main().catch(console.error);
```
</CodeGroup>

</Step>
</Steps>

</Tab>

<Tab title="Decompress">

<Steps>
<Step>
### Decompress to SPL Account

<Note>
The destination SPL/T22 account must exist before decompressing.
</Note>

<CodeGroup>
```typescript Action
import { Keypair } from "@solana/web3.js";
import { createRpc, bn } from "@lightprotocol/stateless.js";
import {
  createMint,
  mintTo,
  decompress,
} from "@lightprotocol/compressed-token";
import { createAssociatedTokenAccount } from "@solana/spl-token";

async function main() {
  const rpc = createRpc();
  const payer = Keypair.generate();
  await rpc.requestAirdrop(payer.publicKey, 10e9);

  const owner = Keypair.generate();
  await rpc.requestAirdrop(owner.publicKey, 1e9);

  const mintAuthority = Keypair.generate();
  const mintKeypair = Keypair.generate();
  const { mint } = await createMint(
    rpc,
    payer,
    mintAuthority.publicKey,
    9,
    mintKeypair
  );

  // Mint compressed tokens (cold storage)
  await mintTo(rpc, payer, mint, owner.publicKey, mintAuthority, bn(1000));

  // Create destination SPL ATA (must exist before decompressing)
  const splAta = await createAssociatedTokenAccount(
    rpc,
    payer,
    mint,
    owner.publicKey
  );

  // Decompress to SPL ATA
  const signature = await decompress(
    rpc,
    payer,
    mint,
    bn(500),
    owner,
    splAta
  );

  console.log("Decompressed 500 tokens to SPL ATA");
  console.log("Transaction:", signature);
}

main().catch(console.error);
```

```typescript With Token Pool
import { Keypair } from "@solana/web3.js";
import { createRpc, bn } from "@lightprotocol/stateless.js";
import {
  createMint,
  mintTo,
  decompress,
  getTokenPoolInfos,
  selectTokenPoolInfosForDecompression,
} from "@lightprotocol/compressed-token";
import { createAssociatedTokenAccount } from "@solana/spl-token";

async function main() {
  const rpc = createRpc();
  const payer = Keypair.generate();
  await rpc.requestAirdrop(payer.publicKey, 10e9);

  const owner = Keypair.generate();
  await rpc.requestAirdrop(owner.publicKey, 1e9);

  const mintAuthority = Keypair.generate();
  const mintKeypair = Keypair.generate();
  const { mint } = await createMint(
    rpc,
    payer,
    mintAuthority.publicKey,
    9,
    mintKeypair
  );

  // Mint compressed tokens (cold storage)
  await mintTo(rpc, payer, mint, owner.publicKey, mintAuthority, bn(1000));

  // Create destination SPL ATA
  const splAta = await createAssociatedTokenAccount(
    rpc,
    payer,
    mint,
    owner.publicKey
  );

  // Get token pool infos and select for decompression
  const tokenPoolInfos = await getTokenPoolInfos(rpc, mint);
  const selectedPools = selectTokenPoolInfosForDecompression(
    tokenPoolInfos,
    bn(500)
  );

  // Decompress with explicit token pool selection
  const signature = await decompress(
    rpc,
    payer,
    mint,
    bn(500),
    owner,
    splAta,
    selectedPools
  );

  console.log("Decompressed 500 tokens to SPL ATA");
  console.log("Transaction:", signature);
}

main().catch(console.error);
```
</CodeGroup>

</Step>
</Steps>

</Tab>
</Tabs>
