---
title: Compress & Decompress
sidebarTitle: Compress & Decompress
description: Convert between SPL tokens and compressed accounts (cold storage)
---

import CTokenTsClientPrerequisites from '/snippets/light-token-guides/light-token-ts-client-prerequisites.mdx';

- **Compress**: Move tokens from SPL/T22 account → compressed accounts (cold storage)
- **Decompress**: Move tokens from compressed accounts (cold storage) → SPL/T22 account

<Info>
Find the source code: [compress.test.ts](https://github.com/Lightprotocol/light-protocol/blob/main/js/compressed-token/tests/e2e/compress.test.ts) | [decompress.test.ts](https://github.com/Lightprotocol/light-protocol/blob/main/js/compressed-token/tests/e2e/decompress.test.ts)
</Info>

## Prerequisites

<CTokenTsClientPrerequisites />

## Usage

<Tabs>
<Tab title="Compress">

<Note>
Supports batch compression to multiple recipients in a single transaction (up to 10 recipients with V2 trees).
</Note>

<CodeGroup>
```typescript Action
import { Keypair } from '@solana/web3.js';
import { createRpc, bn } from '@lightprotocol/stateless.js';
import {
    createMint,
    mintTo,
    decompress,
    compress,
} from '@lightprotocol/compressed-token';
import { createAssociatedTokenAccount } from '@solana/spl-token';

async function main() {
    const rpc = createRpc();
    const payer = Keypair.generate();
    await rpc.requestAirdrop(payer.publicKey, 1e9);

    const owner = Keypair.generate();
    await rpc.requestAirdrop(owner.publicKey, 1e9);

    const mintAuthority = Keypair.generate();
    const mintKeypair = Keypair.generate();

    // 1. Create SPL mint with token pool
    const { mint } = await createMint(
        rpc,
        payer,
        mintAuthority.publicKey,
        9,
        mintKeypair,
    );

    // 2. Create SPL ATA and fund it with SPL tokens
    const splAta = await createAssociatedTokenAccount(
        rpc,
        payer,
        mint,
        owner.publicKey,
    );

    // Mint compressed then decompress to get SPL tokens
    await mintTo(rpc, payer, mint, owner.publicKey, mintAuthority, bn(1000));
    await decompress(rpc, payer, mint, bn(1000), owner, splAta);

    // 3. Compress SPL tokens to cold storage
    const recipient = Keypair.generate();

    const signature = await compress(
        rpc,
        payer,
        mint,
        bn(500),              // amount to compress
        owner,                // owner of SPL account (signer)
        splAta,               // source SPL token account
        recipient.publicKey,  // recipient of compressed tokens
    );

    console.log('Compressed 500 tokens to cold storage');
    console.log('Transaction:', signature);
}

main().catch(console.error);
```

```typescript Batch
import { Keypair } from '@solana/web3.js';
import { createRpc, bn } from '@lightprotocol/stateless.js';
import {
    createMint,
    mintTo,
    decompress,
    compress,
} from '@lightprotocol/compressed-token';
import { createAssociatedTokenAccount } from '@solana/spl-token';

async function main() {
    const rpc = createRpc();
    const payer = Keypair.generate();
    await rpc.requestAirdrop(payer.publicKey, 1e9);

    const owner = Keypair.generate();
    await rpc.requestAirdrop(owner.publicKey, 1e9);

    const mintAuthority = Keypair.generate();
    const mintKeypair = Keypair.generate();

    // 1. Create SPL mint with token pool
    const { mint } = await createMint(
        rpc,
        payer,
        mintAuthority.publicKey,
        9,
        mintKeypair,
    );

    // 2. Create SPL ATA and fund it
    const splAta = await createAssociatedTokenAccount(
        rpc,
        payer,
        mint,
        owner.publicKey,
    );

    await mintTo(rpc, payer, mint, owner.publicKey, mintAuthority, bn(10000));
    await decompress(rpc, payer, mint, bn(10000), owner, splAta);

    // 3. Batch compress to multiple recipients (max 10 for V2 trees)
    const recipients = Array.from({ length: 5 }, () => Keypair.generate().publicKey);
    const amounts = [bn(100), bn(200), bn(300), bn(400), bn(500)];

    const signature = await compress(
        rpc,
        payer,
        mint,
        amounts,      // array of amounts
        owner,
        splAta,
        recipients,   // array of recipients (same length as amounts)
    );

    console.log('Batch compressed to 5 recipients');
    console.log('Transaction:', signature);
}

main().catch(console.error);
```
</CodeGroup>

</Tab>

<Tab title="Decompress">

<Note>
The destination SPL/T22 account must exist before decompressing.
</Note>

<CodeGroup>
```typescript Action
import { Keypair } from '@solana/web3.js';
import { createRpc, bn } from '@lightprotocol/stateless.js';
import {
    createMint,
    mintTo,
    decompress,
} from '@lightprotocol/compressed-token';
import { createAssociatedTokenAccount } from '@solana/spl-token';

async function main() {
    const rpc = createRpc();
    const payer = Keypair.generate();
    await rpc.requestAirdrop(payer.publicKey, 1e9);

    const owner = Keypair.generate();
    await rpc.requestAirdrop(owner.publicKey, 1e9);

    const mintAuthority = Keypair.generate();
    const mintKeypair = Keypair.generate();

    // 1. Create SPL mint with token pool
    const { mint } = await createMint(
        rpc,
        payer,
        mintAuthority.publicKey,
        9,
        mintKeypair,
    );

    // 2. Mint compressed tokens (cold storage)
    await mintTo(rpc, payer, mint, owner.publicKey, mintAuthority, bn(1000));

    // 3. Create destination SPL ATA (must exist)
    const splAta = await createAssociatedTokenAccount(
        rpc,
        payer,
        mint,
        owner.publicKey,
    );

    // 4. Decompress to SPL ATA
    const signature = await decompress(
        rpc,
        payer,
        mint,
        bn(500),   // amount to decompress
        owner,     // owner of compressed tokens (signer)
        splAta,    // destination SPL token account
    );

    console.log('Decompressed 500 tokens to SPL ATA');
    console.log('Transaction:', signature);
}

main().catch(console.error);
```

```typescript With Token Pool
import { Keypair } from '@solana/web3.js';
import { createRpc, bn } from '@lightprotocol/stateless.js';
import {
    createMint,
    mintTo,
    decompress,
    getTokenPoolInfos,
    selectTokenPoolInfosForDecompression,
} from '@lightprotocol/compressed-token';
import { createAssociatedTokenAccount } from '@solana/spl-token';

async function main() {
    const rpc = createRpc();
    const payer = Keypair.generate();
    await rpc.requestAirdrop(payer.publicKey, 1e9);

    const owner = Keypair.generate();
    await rpc.requestAirdrop(owner.publicKey, 1e9);

    const mintAuthority = Keypair.generate();
    const mintKeypair = Keypair.generate();

    // 1. Create SPL mint with token pool
    const { mint } = await createMint(
        rpc,
        payer,
        mintAuthority.publicKey,
        9,
        mintKeypair,
    );

    // 2. Mint compressed tokens (cold storage)
    await mintTo(rpc, payer, mint, owner.publicKey, mintAuthority, bn(1000));

    // 3. Create destination SPL ATA
    const splAta = await createAssociatedTokenAccount(
        rpc,
        payer,
        mint,
        owner.publicKey,
    );

    // 4. Get token pool infos and select for decompression
    const tokenPoolInfos = await getTokenPoolInfos(rpc, mint);
    const selectedPools = selectTokenPoolInfosForDecompression(
        tokenPoolInfos,
        bn(500),  // amount to decompress
    );

    // 5. Decompress with explicit token pool selection
    const signature = await decompress(
        rpc,
        payer,
        mint,
        bn(500),
        owner,
        splAta,
        selectedPools,  // optional: explicitly pass token pools
    );

    console.log('Decompressed 500 tokens to SPL ATA');
    console.log('Transaction:', signature);
}

main().catch(console.error);
```
</CodeGroup>

</Tab>
</Tabs>
