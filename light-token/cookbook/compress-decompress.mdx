---
title: Compress & Decompress
sidebarTitle: Compress & Decompress
description: Convert between SPL tokens and compressed accounts (cold storage)
---

---

import WelcomePageInstall from '/snippets/setup/welcome-page-install.mdx';

- **Compress**: Move tokens from SPL/T22 account → compressed accounts (cold storage)
- **Decompress**: Move tokens from compressed accounts (cold storage) → SPL/T22 account

<Info>
Find the source code: [decompress-interface.ts](https://github.com/Lightprotocol/light-protocol/blob/0c4e2417b2df2d564721b89e18d1aad3665120e7/js/compressed-token/src/v3/actions/decompress-interface.ts)
</Info>

## Get Started

<Tabs>
<Tab title="Compress">

<Steps>
<Step>
### Compress SPL Tokens to Cold Storage

<Accordion title="Installations">
<WelcomePageInstall />
</Accordion>

```bash
# Start local test-validator in separate terminal
light test-validator
```

<Note>
Supports batch compression to multiple recipients in a single transaction (up to 10 recipients with V2 trees).
</Note>

<CodeGroup>
```typescript Action
import { Keypair } from "@solana/web3.js";
import { createRpc, bn } from "@lightprotocol/stateless.js";
import { createMint, mintTo, decompress, compress } from "@lightprotocol/compressed-token";
import { createAssociatedTokenAccount } from "@solana/spl-token";

async function main() {
  const rpc = createRpc();
  const payer = Keypair.generate();
  const sig = await rpc.requestAirdrop(payer.publicKey, 10e9);
  await rpc.confirmTransaction(sig);

  // Setup: Get SPL tokens (needed to compress)
  const { mint } = await createMint(rpc, payer, payer.publicKey, 9);
  const splAta = await createAssociatedTokenAccount(rpc, payer, mint, payer.publicKey);
  await mintTo(rpc, payer, mint, payer.publicKey, payer, bn(1000));
  await decompress(rpc, payer, mint, bn(1000), payer, splAta);

  // Compress SPL tokens to cold storage
  const recipient = Keypair.generate();
  const tx = await compress(rpc, payer, mint, bn(500), payer, splAta, recipient.publicKey);

  console.log("Tx:", tx);
}

main().catch(console.error);
```

```typescript Batch
import { Keypair } from "@solana/web3.js";
import { createRpc, bn } from "@lightprotocol/stateless.js";
import { createMint, mintTo, decompress, compress } from "@lightprotocol/compressed-token";
import { createAssociatedTokenAccount } from "@solana/spl-token";

async function main() {
  const rpc = createRpc();
  const payer = Keypair.generate();
  const sig = await rpc.requestAirdrop(payer.publicKey, 10e9);
  await rpc.confirmTransaction(sig);

  // Setup: Get SPL tokens (needed to compress)
  const { mint } = await createMint(rpc, payer, payer.publicKey, 9);
  const splAta = await createAssociatedTokenAccount(rpc, payer, mint, payer.publicKey);
  await mintTo(rpc, payer, mint, payer.publicKey, payer, bn(10000));
  await decompress(rpc, payer, mint, bn(10000), payer, splAta);

  // Batch compress to multiple recipients
  const recipients = Array.from({ length: 5 }, () => Keypair.generate().publicKey);
  const amounts = [bn(100), bn(200), bn(300), bn(400), bn(500)];

  const tx = await compress(rpc, payer, mint, amounts, payer, splAta, recipients);

  console.log("Tx:", tx);
}

main().catch(console.error);
```
</CodeGroup>

</Step>
</Steps>

</Tab>

<Tab title="Decompress">

<Steps>
<Step>
### Decompress to SPL Account

<Note>
The destination SPL/T22 account must exist before decompressing.
</Note>

<CodeGroup>
```typescript Action
import { Keypair } from "@solana/web3.js";
import { createRpc, bn } from "@lightprotocol/stateless.js";
import { createMint, mintTo, decompress } from "@lightprotocol/compressed-token";
import { createAssociatedTokenAccount } from "@solana/spl-token";

async function main() {
  const rpc = createRpc();
  const payer = Keypair.generate();
  const sig = await rpc.requestAirdrop(payer.publicKey, 10e9);
  await rpc.confirmTransaction(sig);

  // Setup: Get compressed tokens (cold storage)
  const { mint } = await createMint(rpc, payer, payer.publicKey, 9);
  await mintTo(rpc, payer, mint, payer.publicKey, payer, bn(1000));

  // Decompress to SPL ATA
  const splAta = await createAssociatedTokenAccount(rpc, payer, mint, payer.publicKey);
  const tx = await decompress(rpc, payer, mint, bn(500), payer, splAta);

  console.log("Tx:", tx);
}

main().catch(console.error);
```

```typescript With Token Pool
import { Keypair } from "@solana/web3.js";
import { createRpc, bn } from "@lightprotocol/stateless.js";
import {
  createMint,
  mintTo,
  decompress,
  getTokenPoolInfos,
  selectTokenPoolInfosForDecompression,
} from "@lightprotocol/compressed-token";
import { createAssociatedTokenAccount } from "@solana/spl-token";

async function main() {
  const rpc = createRpc();
  const payer = Keypair.generate();
  const sig = await rpc.requestAirdrop(payer.publicKey, 10e9);
  await rpc.confirmTransaction(sig);

  // Setup: Get compressed tokens (cold storage)
  const { mint } = await createMint(rpc, payer, payer.publicKey, 9);
  await mintTo(rpc, payer, mint, payer.publicKey, payer, bn(1000));

  // Create destination SPL ATA
  const splAta = await createAssociatedTokenAccount(rpc, payer, mint, payer.publicKey);

  // Get token pool infos and select for decompression
  const tokenPoolInfos = await getTokenPoolInfos(rpc, mint);
  const selectedPools = selectTokenPoolInfosForDecompression(tokenPoolInfos, bn(500));

  // Decompress with explicit token pool selection
  const tx = await decompress(rpc, payer, mint, bn(500), payer, splAta, selectedPools);

  console.log("Tx:", tx);
}

main().catch(console.error);
```
</CodeGroup>

</Step>
</Steps>

</Tab>
</Tabs>
