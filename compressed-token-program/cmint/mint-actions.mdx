---
title: Mint actions overview
description: Builder instructions for creating and managing compressed token accounts and transfers.
---

The CToken SDK provides builder instructions for managing compressed token accounts. These instructions follow a consistent builder pattern and handle account creation, minting, transfers, and conversions between compressed and SPL token formats.

## Account creation

### CreateCTokenAccount

Creates a CToken Solana account (decompressed compressed token account). Can be created with or without a `Compressible` extension that enables automatic compression when rent balance is insufficient.

**Use when:** You need to create a new token account for a user to hold compressed tokens, especially when you want flexible rent management through the Compressible extension.

**Key parameters:**

- `account_pubkey`: Public key of the CToken account to create
- `mint_pubkey`: Public key of the associated mint
- `owner_pubkey`: Public key of the account owner
- `compressible_config`: (Optional) Configuration for Compressible extension:
  - `rent_payment`: Number of epochs to prepay for rent (cannot be 1)
  - `write_top_up`: Additional lamports for future write operations
  - `compress_to_account_pubkey`: Optional specific pubkey for compression target (useful for PDA token accounts)

**Example:**

```rust
use light_compressed_token_sdk::ctoken::create_token_account::{
    create_compressible_token_account_instruction,
    CreateCompressibleTokenAccount,
};
use light_ctoken_types::state::TokenDataVersion;

let create_token_account_ix = create_compressible_token_account_instruction(
    CreateCompressibleTokenAccount {
        account_pubkey: token_account_keypair.pubkey(),
        mint_pubkey: mint,
        owner_pubkey: owner,
        compressible_config,
        rent_sponsor,
        pre_pay_num_epochs: 2,
        lamports_per_write: Some(100),
        payer: payer.pubkey(),
        compress_to_account_pubkey: None,
        token_account_version: TokenDataVersion::ShaFlat,
    },
)?;
```

### CreateAssociatedTokenAccount

Creates an associated token account (ATA) for compressed tokens, passing `owner` and `mint` public keys as instruction data. Supports both basic and compressible accounts. Includes idempotent versions that succeed even if the account already exists.

**Use when:** Creating an ATA where owner and mint public keys are readily available and can be included directly in instruction data.

**Key parameters:**

- `payer`: Public key of the account paying for transaction and account creation
- `owner`: Public key of the ATA owner
- `mint`: Public key of the mint
- `ata_pubkey`: Derived public key of the ATA (use `derive_ctoken_ata`)
- `bump`: PDA bump seed for ATA derivation

**Compressible-specific parameters:**

- `compressible_config`: Public key of the CompressibleConfig account
- `rent_sponsor`: Public key receiving lamports when account is closed by rent authority
- `pre_pay_num_epochs`: Number of epochs of rent to prepay
- `lamports_per_write`: (Optional) Initial lamports for rent top-ups
- `token_account_version`: TokenDataVersion specifying hashing scheme

**Example:**

```rust
use light_compressed_token_sdk::ctoken::create_associated_token_account::{
    create_associated_token_account,
    create_compressible_associated_token_account,
    CreateCompressibleAssociatedTokenAccountInputs,
};
use light_ctoken_types::state::TokenDataVersion;

// Basic ATA
let basic_ata_ix = create_associated_token_account(
    payer_pubkey,
    owner_pubkey,
    mint_pubkey,
)?;

// Compressible ATA
let compressible_ata_ix = create_compressible_associated_token_account(
    CreateCompressibleAssociatedTokenAccountInputs {
        payer: payer_pubkey,
        owner: owner_pubkey,
        mint: mint_pubkey,
        compressible_config,
        rent_sponsor,
        pre_pay_num_epochs: 0,
        lamports_per_write: Some(150),
        token_account_version: TokenDataVersion::ShaFlat,
    },
)?;
```

### CreateAssociatedTokenAccount2

Creates an associated token account with `owner` and `mint` passed as account infos rather than instruction data. Use when the program needs to perform checks or operations directly on the owner or mint accounts (e.g., signature verification, accessing mint data).

**Use when:** The program needs to access owner or mint accounts as AccountInfo objects for verification or data access beyond just knowing their public keys.

**Key parameters:**

Same as CreateAssociatedTokenAccount, but `owner` and `mint` are passed as `AccountMeta` entries instead of instruction data.

**Example:**

```rust
use light_compressed_token_sdk::ctoken::create_associated_token_account::{
    create_associated_token_account2,
    create_compressible_associated_token_account2,
};

// Basic ATA (version 2)
let basic_ata2_ix = create_associated_token_account2(
    payer_pubkey,
    owner_pubkey,
    mint_pubkey,
)?;

// Compressible ATA (version 2)
let compressible_ata2_ix = create_compressible_associated_token_account2(
    CreateCompressibleAssociatedTokenAccountInputs {
        payer: payer_pubkey,
        owner: owner_pubkey,
        mint: mint_pubkey,
        compressible_config,
        rent_sponsor,
        pre_pay_num_epochs: 0,
        lamports_per_write: Some(150),
        token_account_version: TokenDataVersion::ShaFlat,
    },
)?;
```

## Mint operations

### CreateCMint

Creates a new compressed mint account with initial authorities and optional TokenMetadata extension. Part of the MintAction batch instruction.

**Use when:** Defining a new compressed token type on Solana with custom decimals, authorities, and metadata.

**Key parameters:**

- `decimals`: Number of decimal places (u8)
- `mint_authority`: Public key of the authority that can mint tokens
- `freeze_authority`: (Optional) Public key of the authority that can freeze token accounts
- `proof`: CompressedProof for compressed account validation
- `address_merkle_tree_root_index`: Root index for address proof (u16)
- `mint_signer`: Public key used to derive the mint PDA
- `payer`: Public key of the transaction fee payer
- `address_tree_pubkey`: Public key of the address Merkle tree
- `output_queue`: Public key of the output queue
- `extensions`: (Optional) Vector of extensions, including TokenMetadata:
  - `update_authority`: Authority for metadata updates
  - `name`: Token name (bytes)
  - `symbol`: Token symbol (bytes)
  - `uri`: Metadata URI (bytes)
  - `additional_metadata`: Key-value pairs for custom metadata
- `version`: Compressed mint version (u8)

**Example:**

```rust
use light_compressed_token_sdk::compressed_token::create_compressed_mint::{
    create_compressed_mint, CreateCompressedMintInputs
};
use light_ctoken_types::instructions::extensions::{
    ExtensionInstructionData,
    token_metadata::TokenMetadataInstructionData
};

let token_metadata = TokenMetadataInstructionData {
    update_authority: Some(mint_authority.into()),
    name: "MyToken".to_string().into_bytes(),
    symbol: "MTK".to_string().into_bytes(),
    uri: "https://example.com/mytoken.json".to_string().into_bytes(),
    additional_metadata: Some(vec![
        AdditionalMetadata {
            key: b"creator".to_vec(),
            value: b"Alice".to_vec(),
        },
    ]),
};

let instruction = create_compressed_mint(CreateCompressedMintInputs {
    version: 3,
    decimals: 6,
    mint_authority,
    freeze_authority: Some(freeze_authority),
    proof: rpc_result_proof,
    address_merkle_tree_root_index: 0,
    mint_signer: mint_signer.pubkey(),
    payer: payer.pubkey(),
    address_tree_pubkey,
    output_queue,
    extensions: Some(vec![ExtensionInstructionData::TokenMetadata(token_metadata)]),
})?;
```

### MintToCTokenTransfer

Mints new tokens directly to decompressed CToken accounts. Part of the MintAction batch instruction.

**Use when:** Issuing new tokens of a specific compressed mint to users holding CToken accounts.

**Key parameters:**

- `account_index`: Index into remaining accounts for the recipient token account (u8)
- `amount`: Number of tokens to mint (u64)

**Example:**

```rust
use light_compressed_token_sdk::compressed_token::mint_action::{
    MintActionCompressedInstructionData,
    MintToCTokenAction,
};

let instruction_data = MintActionCompressedInstructionData::new_mint(
    input.compressed_mint_with_context.address,
    input.compressed_mint_with_context.root_index,
    compressed_proof,
    input.compressed_mint_with_context.mint.clone(),
)
.with_mint_to_ctoken(MintToCTokenAction {
    account_index: 0, // First account in remaining accounts
    amount: 1_000_000,
});
```

## Transfer operations

### CtokenTransfer

Transfers tokens between two decompressed CToken Solana accounts. Follows SPL Token semantics and includes automatic rent top-ups for compressible accounts.

**Use when:** Performing standard token transfers between users who both hold decompressed CToken accounts.

**Key parameters:**

- `source`: Public key of the source CToken account
- `destination`: Public key of the destination CToken account
- `amount`: Number of tokens to transfer (u64)
- `authority`: Public key of the authority (owner or delegate) that can spend from source
- `payer`: (Optional) Public key paying for transaction fees and rent top-ups

**Example:**

```rust
use light_client::rpc::Rpc;
use light_token_client::actions::ctoken_transfer::create_transfer_ctoken_instruction;

async fn example_ctoken_transfer<R: Rpc>(
    rpc: &mut R,
    source_pubkey: Pubkey,
    destination_pubkey: Pubkey,
    amount: u64,
    authority_keypair: &Keypair,
    payer_keypair: &Keypair,
) -> Result<(), RpcError> {
    let transfer_instruction = create_transfer_ctoken_instruction(
        source_pubkey,
        destination_pubkey,
        amount,
        authority_keypair.pubkey(),
    )?;

    let mut signers = vec![payer_keypair];
    if authority_keypair.pubkey() != payer_keypair.pubkey() {
        signers.push(authority_keypair);
    }

    rpc.create_and_send_transaction(
        &[transfer_instruction],
        &payer_keypair.pubkey(),
        &signers
    ).await?;

    Ok(())
}
```

### SplToCtokenTransfer

Converts SPL tokens into compressed tokens and transfers them to a CToken account. Interacts with a token pool PDA to synchronize supply between SPL and compressed tokens.

**Use when:** Bridging tokens from the SPL ecosystem to compressed tokens, allowing users to deposit SPL tokens into their CToken accounts.

**Key parameters:**

- `source_spl_token_account`: Public key of the source SPL token account
- `to`: Public key of the destination CToken account
- `amount`: Number of tokens to transfer
- `authority`: Authority of the source SPL token account (signer)
- `mint`: Public key of the mint
- `payer`: Transaction fee payer
- `token_pool_pda`: Public key of the token pool PDA
- `token_pool_pda_bump`: Bump seed for the token pool PDA
- `spl_token_program`: Public key of the SPL Token program

**Example:**

```rust
use light_token_client::actions::transfer2::spl_to_ctoken_transfer;

spl_to_ctoken_transfer(
    &mut rpc,
    spl_token_account_keypair.pubkey(),
    associated_token_account,
    transfer_amount,
    &sender,
    &payer,
)
.await?;
```

### CtokenToSpl

Converts compressed tokens back to SPL tokens and transfers them to an SPL token account. Compresses the CToken balance into the token pool, then decompresses to the SPL account.

**Use when:** Users want to withdraw compressed tokens from a CToken account back into the standard SPL token ecosystem.

**Key parameters:**

- `source_ctoken_account`: Public key of the source CToken account
- `destination_spl_token_account`: Public key of the destination SPL token account
- `amount`: Number of tokens to transfer
- `authority`: Authority of the source CToken account (signer)
- `mint`: Public key of the mint
- `payer`: Transaction fee payer
- `token_pool_pda`: Public key of the token pool PDA
- `token_pool_pda_bump`: Bump seed for the token pool PDA
- `spl_token_program`: Public key of the SPL Token program

**Example:**

```rust
use light_compressed_token_sdk::ctoken::transfer_interface::TransferCtokenToSpl;
use light_compressed_token_sdk::token_pool::find_token_pool_pda_with_index;

let (token_pool_pda, token_pool_pda_bump) = find_token_pool_pda_with_index(&mint, 0);

let transfer_ix = TransferCtokenToSpl {
    source_ctoken_account,
    destination_spl_token_account,
    amount,
    authority: authority.pubkey(),
    mint,
    payer: payer.pubkey(),
    token_pool_pda,
    token_pool_pda_bump,
    spl_token_program: Pubkey::new_from_array(SPL_TOKEN_PROGRAM_ID),
}
.instruction()?;

rpc.create_and_send_transaction(
    &[transfer_ix],
    &payer.pubkey(),
    &signers
).await?;
```

### CtokenToSplTransferAnd

Transfers tokens from a CToken account to an SPL token account and closes the source CToken account in a single transaction. Returns rent exemption to the authority.

**Use when:** Converting all tokens from a CToken account to SPL format while simultaneously cleaning up the CToken account.

**Key parameters:**

Same as CtokenToSpl, plus account closure handling.

**Example:**

```rust
use light_compressed_token_sdk::ctoken::transfer_interface::CtokenToSplTransferAndClose;

let transfer_and_close_ix = CtokenToSplTransferAndClose {
    source_ctoken_account,
    destination_spl_token_account,
    amount,
    authority: authority.pubkey(),
    mint,
    payer: payer.pubkey(),
    token_pool_pda,
    token_pool_pda_bump,
    spl_token_program: Pubkey::new_from_array(SPL_TOKEN_PROGRAM_ID),
}
.instruction()?;

rpc.create_and_send_transaction(
    &[transfer_and_close_ix],
    &payer.pubkey(),
    &signers
).await?;
```

## Account management

### Close Token Account

Permanently closes a decompressed CToken Solana account. Distributes remaining lamports to a destination account, then zeros out and resizes the account to 0 bytes to prevent revival attacks. Works with both regular and compressible token accounts.

**Use when:** You want to permanently close a CToken account with a zero token balance and reclaim its rent exemption.

**Key parameters:**

- `token_account`: The CToken account to close (must be initialized with zero balance)
- `destination`: Account receiving remaining user funds (non-rent lamports)
- `authority`: Signer (account owner or rent authority for compressible accounts)
- `rent_sponsor`: (Required for compressible accounts) Account receiving rent exemption

**Example:**

```rust
use light_compressed_token_sdk::ctoken::close_account::{
    close_account,
    close_compressible_account,
};

// Close non-compressible account
let close_ix = close_account(
    token_account_pubkey,
    destination_pubkey,
    authority.pubkey(),
)?;

// Close compressible account
let close_compressible_ix = close_compressible_account(
    token_account_pubkey,
    destination_pubkey,
    authority.pubkey(),
    rent_sponsor_pubkey,
)?;
```

### CompressAndClose mode

The `Transfer2` instruction provides a `CompressAndClose` mode that compresses the full balance of a CToken account and closes it in a single transaction.

**Use when:** Optimizing storage and costs by moving tokens off-chain into compressed format while cleaning up the on-chain account.

**Key parameters:**

- `amount`: Full balance of the CToken account to compress
- `mode`: Set to `CompressionMode::CompressAndClose`
- `mint`: Index of the mint account
- `source_or_recipient`: Index of the source CToken account
- `authority`: Index of the owner/delegate account (must be signer)
- `pool_account_index`: Used as `rent_sponsor_index` for CompressAndClose
- `pool_index`: Used as `compressed_account_index` for CompressAndClose
- `bump`: Used as `destination_index` for CompressAndClose

**Example:**

```rust
use light_token_client::actions::compress_and_close::compress_and_close;

// Compress full balance and close account
compress_and_close(
    &mut rpc,
    ctoken_account_pubkey,
    compressed_account_index,
    &authority,
    &payer,
)
.await?;
```